/**
 * Stamp was generated by <StampedFile.kt>
 * Last time was modified by <StampedFile.kt>
 *
 * Name: <UiHandlerLoggingDecorator.java>
 * Created: <11/11/2020, 08:24:43 PM>
 * Modified: <17/11/2020, 10:48:39 PM>
 * Version: <201>
 */

package worder.launcher.ui;

import worder.launcher.logging.SimpleLogger;

import java.io.ByteArrayOutputStream;
import java.io.PrintStream;

public class UiHandlerLoggingDecorator implements UiHandler {
    private final UiHandler uiHandler;
    private final SimpleLogger simpleLogger;


    public UiHandlerLoggingDecorator(UiHandler uiHandler, SimpleLogger simpleLogger) {
        Thread.setDefaultUncaughtExceptionHandler((thread, exception) -> {
                    var bytes = new ByteArrayOutputStream();
                    exception.printStackTrace(new PrintStream(bytes));
                    error(bytes.toString());
                    System.exit(1);
                }
        );

        this.uiHandler = uiHandler;
        this.simpleLogger = simpleLogger;
    }


    @Override
    public void show() {
        simpleLogger.log("SHOW", "Call of show() on " + uiHandler);
        uiHandler.show();
    }

    @Override
    public void dispose(long delay) {
        simpleLogger.log("DISPOSE", "Call of dispose(" + delay + ") on " + uiHandler);
        uiHandler.dispose(delay);
        Thread.setDefaultUncaughtExceptionHandler(null);
    }

    @Override
    public void progress(String progress) {
        simpleLogger.log("PROGRESS", progress);
        uiHandler.progress(progress);
    }

    @Override
    public void error(String message) {
        simpleLogger.log("ERROR", message);
        uiHandler.error(message);
    }
}
