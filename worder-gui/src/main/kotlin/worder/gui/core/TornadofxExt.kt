/**
 * Stamp was generated by <generateFileStamps.sh>
 * Last time was modified by <StampedFile.kt>
 *
 * Name: <TornadofxExt.kt>
 * Created: <02/07/2020, 11:27:00 PM>
 * Modified: <04/08/2020, 07:11:08 PM>
 * Version: <27>
 */

package worder.gui.core

import javafx.beans.property.ReadOnlyProperty
import javafx.beans.value.ObservableValue
import javafx.event.EventTarget
import javafx.scene.control.Label
import javafx.scene.layout.VBox
import tornadofx.attachTo
import tornadofx.find
import tornadofx.onChange
import tornadofx.stringBinding
import tornadofx.tooltip
import worder.gui.core.model.ObservableStats
import worder.gui.core.model.WorderStatus
import worder.gui.core.ui.ListBasedStatsFragment
import worder.gui.core.ui.MapBasedStatsFragment

inline fun EventTarget.worderStatusLabel(
        status: ObservableValue<out WorderStatus>,
        op: Label.() -> Unit = {}
) = Label().attachTo(this, op) { label ->
    label.textProperty().bind(status.stringBinding { "$it" })

    label.tooltip(status.value.description)
    label.textFill = status.value.color

    status.onChange {
        label.tooltip(status.value.description)
        label.textFill = status.value.color
    }
}

inline fun EventTarget.observableStats(
        observableStats: ObservableStats,
        hideNullable: Boolean = false,
        noinline commonNameMutator: (String.() -> String)? = null,
        noinline commonValueMutator: (Any?.() -> String)? = null,
        nameMutators: Map<String, String.() -> String>? = null,
        valueMutators: Map<String, Any?.() -> String>? = null,
        op: VBox.() -> Unit = {}
): VBox = find(
        type = MapBasedStatsFragment::class,
        params = mapOf(
                "blockTitle" to observableStats.origin,
                "stats" to observableStats.asTitledMap,
                "hideNullable" to hideNullable,
                "commonNameMutator" to commonNameMutator,
                "commonValueMutator" to commonValueMutator,
                "nameMutators" to nameMutators,
                "valueMutators" to valueMutators
        )
).root.attachTo(this, op)

inline fun EventTarget.listBasedStats(
        blockTitle: String? = null,
        statsProperties: List<ReadOnlyProperty<*>>,
        noinline commonNameMutator: (String.() -> String)? = null,
        noinline commonValueMutator: (Any?.() -> String)? = null,
        nameMutators: Map<String, String.() -> String>? = null,
        valueMutators: Map<String, Any?.() -> String>? = null,
        op: VBox.() -> Unit = {}
): VBox = find(
        type = ListBasedStatsFragment::class,
        params = mapOf(
                "blockTitle" to blockTitle,
                "stats" to statsProperties,
                "commonNameMutator" to commonNameMutator,
                "commonValueMutator" to commonValueMutator,
                "nameMutators" to nameMutators,
                "valueMutators" to valueMutators
        )
).root.attachTo(this, op)
