/**
 * Stamp was generated by <generateFileStamps.sh>
 * Last time was modified by <StampedFile.kt>
 *
 * Name: <TornadofxExt.kt>
 * Created: <02/07/2020, 11:27:00 PM>
 * Modified: <17/07/2020, 10:46:37 PM>
 * Version: <19>
 */

package worder.core.view

import javafx.beans.property.ReadOnlyProperty
import javafx.beans.value.ObservableValue
import javafx.collections.ObservableMap
import javafx.event.EventTarget
import javafx.scene.control.Label
import tornadofx.Component
import tornadofx.attachTo
import tornadofx.onChange
import tornadofx.stringBinding
import tornadofx.tooltip
import worder.core.model.ObservableStats
import worder.core.model.Status

inline fun EventTarget.worderStatusLabel(
        status: ObservableValue<out Status>,
        op: Label.() -> Unit = {}
) = Label().attachTo(this, op) { label ->
    label.textProperty().bind(status.stringBinding { "$it" })

    label.tooltip(status.value.description)
    label.textFill = status.value.color

    status.onChange {
        label.tooltip(status.value.description)
        label.textFill = status.value.color
    }
}

fun Component.observableStats(
        observableStats: ObservableStats,
        commonNameMutator: (String.() -> String)? = null,
        commonValueMutator: (Any?.() -> String)? = null,
        nameMutators: Map<String, String.() -> String>? = null,
        valueMutators: Map<String, Any?.() -> String>? = null
) = mapBasedStats(
        blockTitle = observableStats.origin,
        stats = observableStats.asTitledMapProperty,
        commonNameMutator = commonNameMutator,
        commonValueMutator = commonValueMutator,
        nameMutators = nameMutators,
        valueMutators = valueMutators
)

fun Component.mapBasedStats(
        stats: ObservableMap<String, Any?>,
        blockTitle: String? = null,
        commonNameMutator: (String.() -> String)? = null,
        commonValueMutator: (Any?.() -> String)? = null,
        nameMutators: Map<String, String.() -> String>? = null,
        valueMutators: Map<String, Any?.() -> String>? = null
) = find<MapBasedStatsFragment>(
        "blockTitle" to blockTitle,
        "stats" to stats,
        "commonNameMutator" to commonNameMutator,
        "commonValueMutator" to commonValueMutator,
        "nameMutators" to nameMutators,
        "valueMutators" to valueMutators
)

fun Component.listBasedStats(
        statsProperties: List<ReadOnlyProperty<*>>,
        blockTitle: String? = null,
        commonNameMutator: (String.() -> String)? = null,
        commonValueMutator: (Any?.() -> String)? = null,
        nameMutators: Map<String, String.() -> String>? = null,
        valueMutators: Map<String, Any?.() -> String>? = null
) = find<ListBasedStatsFragment>(
        "blockTitle" to blockTitle,
        "stats" to statsProperties,
        "commonNameMutator" to commonNameMutator,
        "commonValueMutator" to commonValueMutator,
        "nameMutators" to nameMutators,
        "valueMutators" to valueMutators
)
