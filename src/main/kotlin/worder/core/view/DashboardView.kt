/**
 * Stamp was generated by <generateFileStamps.sh>
 * Last time was modified by <StampedSourceFile.kt>
 *
 * Created: <7/2/20, 11:27 PM>
 * Modified: <7/4/20, 8:55 PM>
 * Version: <3>
 */

package worder.core.view

import javafx.geometry.Pos
import tornadofx.View
import tornadofx.hbox
import worder.database.DatabaseController
import worder.database.DatabaseEventListener
import worder.database.model.WorderDB

class DashboardView : View(), DatabaseEventListener {
    private val databaseController: DatabaseController by inject()

    override val root = hbox(alignment = Pos.TOP_CENTER)


    init {
        databaseController.subscribe(this)
    }


    override fun onDatabaseConnection(db: WorderDB) {
        root.add(find<ObservableStatsFragment>(
                "observableStats" to databaseController.observableStats,
                "valueMutators" to mapOf("Data source" to { ds: Any? -> ds.toString().substringAfterLast("/") })
        ))

        root.add(find<ObservableStatsFragment>("observableStats" to db.observableSummaryStats).root)
        root.add(find<ObservableStatsFragment>("observableStats" to db.observableTrackStats).root)
        root.add(find<ObservableStatsFragment>("observableStats" to db.inserter.observableInserterStats).root)
        root.add(find<ObservableStatsFragment>("observableStats" to db.updater.observableUpdaterStats))
    }

    override fun onDatabaseDisconnection() {
        root.children.clear()
    }
}
